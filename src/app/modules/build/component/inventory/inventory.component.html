<main *ngIf="character !== null">
    <mat-card class="gear">
        <mat-card-content>
            <div class="equipment">
                <div class="top-equipment">
                    <app-item-slot class="helm"
                        [base]="bases.Helm"
                        [item]="character.gear.helm"
                        [maxLevel]="character.level"
                        [heroClass]="character.heroClass"
                        (changed)="updateHelm($event)">
                    </app-item-slot>
                    <app-item-slot class="amulet"
                        [base]="bases.Amulet"
                        [item]="character.gear.amulet"
                        [maxLevel]="character.level"
                        [heroClass]="character.heroClass"
                        (changed)="updateAmulet($event)">
                    </app-item-slot>
                </div>
                <div class="center-equipment">
                    <div class="left-equipment">
                        <app-item-slot class="shoulder"
                            [base]="bases.Shoulder"
                            [item]="character.gear.shoulder"
                            [maxLevel]="character.level"
                            (changed)="updateShoulder($event)">
                        </app-item-slot>
                        <app-item-slot class="bracer"
                            [base]="bases.Bracer"
                            [item]="character.gear.bracer"
                            [maxLevel]="character.level"
                            (changed)="updateBracer($event)">
                        </app-item-slot>
                        <app-item-slot class="glove"
                            [base]="bases.Glove"
                            [item]="character.gear.glove"
                            [maxLevel]="character.level"
                            (changed)="updateGlove($event)">
                        </app-item-slot>
                    </div>
                    <div class="character-preview">
                        <div class="actions">
                            <mat-icon [matMenuTriggerFor]="menu" (contextmenu)="openCharacterSettings()">settings</mat-icon>
                            <mat-menu #menu="matMenu" xPosition="after" [overlapTrigger]="true">
                                <ng-template matMenuContent>
                                    <button mat-menu-item (click)="editCharacterLevel()">Change hero level</button>
                                    <button mat-menu-item *ngIf="character.reaper !== null" (click)="optimizeReaperEnchantments()">Optimise Reaper enchantments</button>
                                    <button mat-menu-item [matMenuTriggerFor]="attributes">Optimise Attribute enchantments</button>
                                    <button mat-menu-item [matMenuTriggerFor]="skills">Optimise Skill enchantments</button>
                                </ng-template>
                                <mat-menu #attributes="matMenu">
                                    <button mat-menu-item>Fishes</button>
                                    <button mat-menu-item>Amphibians</button>
                                    <button mat-menu-item>Reptiles</button>
                                    <button mat-menu-item>Birds</button>
                                    <button mat-menu-item>Mammals</button>
                                </mat-menu>
                                <mat-menu #skills="matMenu">
                                    <button mat-menu-item>Primary</button>
                                    <button mat-menu-item>Secondary</button>
                                    <button mat-menu-item>Support</button>
                                </mat-menu>
                            </mat-menu>
                        </div>
                        <app-character-animation [heroClass]="character.heroClass"></app-character-animation>
                    </div>
                    <div class="right-equipment">
                        <app-item-slot class="body"
                            [base]="bases.Body"
                            [item]="character.gear.body"
                            [maxLevel]="character.level"
                            (changed)="updateBody($event)">
                        </app-item-slot>
                        <app-item-slot class="cape"
                            [base]="bases.Cape"
                            [item]="character.gear.cape"
                            [maxLevel]="character.level"
                            (changed)="updateCape($event)">
                        </app-item-slot>
                        <app-item-slot class="belt"
                            [base]="bases.Belt"
                            [item]="character.gear.belt"
                            [maxLevel]="character.level"
                            (changed)="updateBelt($event)">
                        </app-item-slot>
                    </div>
                </div>
                <div class="bottom-equipment">
                    <app-item-slot class="ring_l"
                        [base]="bases.Ring"
                        [item]="character.gear.ring_l"
                        [maxLevel]="character.level"
                        [heroClass]="character.heroClass"
                        (changed)="updateLeftRing($event)">
                    </app-item-slot>
                    <app-item-slot class="boot"
                        [base]="bases.Boot"
                        [item]="character.gear.boot"
                        [maxLevel]="character.level"
                        [heroClass]="character.heroClass"
                        (changed)="updateBoot($event)">
                    </app-item-slot>
                    <app-item-slot class="ring_r"
                        [base]="bases.Ring"
                        [item]="character.gear.ring_r"
                        [maxLevel]="character.level"
                        [heroClass]="character.heroClass"
                        (changed)="updateRightRing($event)">
                    </app-item-slot>
                </div>
            </div>
            <hr/>
            <div class="weapon">
                <app-reaper-slot
                    [reaper]="character.reaper"
                    [heroClass]="character.heroClass"
                    (changed)="updateReaper($event)">
                </app-reaper-slot>
            </div>
            <div class="skills">
                <app-skill-bar></app-skill-bar>
            </div>
        </mat-card-content>
    </mat-card>
    <mat-card class="inventory">
        <mat-card-content>
            <mat-tab-group animationDuration="0ms" color="white" direction="vertical">
                <mat-tab>
                    <ng-template mat-tab-label>
                        <div class="items-group-label"
                            [class.drag-on]="isDragging && itemGroupBeingDraggedOn === character.inventory"
                            [class.drag-possible]="itemGroupDragDropPossible"
                            [class.drag-impossible]="!itemGroupDragDropPossible"
                            (mouseenter)="dragInItemsGroup(character.inventory)"
                            (mouseleave)="dragOutItemsGroup()"
                            (mouseup)="dragDrop(character.inventory)">Bag</div>
                    </ng-template>
                    <div class="items bag">
                        <app-item-slot *ngFor="let item of character.inventory; let i = index"
                            [item]="item"
                            [maxLevel]="character.level"
                            [heroClass]="character.heroClass"
                            (changed)="updateIventoryItem(i, $event)">
                        </app-item-slot>
                    </div>
                </mat-tab>
                <mat-tab *ngFor="let stash of character.sharedInventory; let s = index">
                    <ng-template mat-tab-label>
                        <div class="items-group-label"
                            [class.drag-on]="isDragging && itemGroupBeingDraggedOn === stash"
                            [class.drag-possible]="itemGroupDragDropPossible"
                            [class.drag-impossible]="!itemGroupDragDropPossible"
                            (mouseenter)="dragInItemsGroup(stash)"
                            (mouseleave)="dragOutItemsGroup()"
                            (mouseup)="dragDrop(stash)">Stash {{s + 1}}</div>
                    </ng-template>
                    <div class="items stash">
                        <app-item-slot *ngFor="let item of stash; let i = index"
                            [item]="item"
                            [maxLevel]="character.level"
                            [heroClass]="character.heroClass"
                            (changed)="updateSharedInventoryItem(s, i, $event)">
                        </app-item-slot>
                    </div>
                </mat-tab>
            </mat-tab-group>
        </mat-card-content>
    </mat-card>
</main>